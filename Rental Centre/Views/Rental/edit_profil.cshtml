@model Rental_Centre.Models.msrental

@{
    ViewBag.Title = "edit_password";
    ViewBag.Profile = ViewBag.logged_in.profil;
    ViewBag.Nama_user = ViewBag.logged_in.nama_rental;
    ViewBag.Toko_user = ViewBag.logged_in.nama_toko;
    ViewBag.mskelompokjenis = ViewBag.mskelompokjenis;
    Layout = "~/Views/Shared/_RentalTemplate.cshtml";
}

<style>
    input {
        border: 0;
        outline: 0;
        background: transparent;
        border-bottom: 3px solid blue;
        width: inherit;
    }
</style>
<div class="row">
    <div class="col">
        @ViewBag.error
    </div>
</div>
<form action="edit_profil" method="post" id="add_myAction" autocomplete="off">
    <div class="container">
        <a>Profile</a> / <a href="">Ubah Profile</a>
        <div class="card">
            <div class="card-body">
                <div class="footer-widget">
                    <h4 style="color:black">Edi Profile</h4>
                    <br />
                    <div class="row">
                        <div class="col">
                            Nama pengguna<span style="color:red">*</span>
                            <input type="text" name="nama_rental" id="nama_rental" required value="@Model.nama_rental" />
                            <input type="hidden" name="id_rental" value="@Model.id_rental" />
                        </div>
                        <div class="col">
                            Username Akun<span style="color:red">*</span>
                            <input type="text" name="username" id="username" required value="@Model.username" readonly class="form-control" />
                        </div>
                        <div class="col">
                            Foto profil<span style="color:red">*</span>
                            <input type="file" name="profil" id="profils" class="form-control" />
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col">
                            <div class="row">
                                <div class="col-3">
                                    Jenis kelamin
                                    <div class="radio-inline ">
                                        @{
                                            if (Model.jenis_kelamin == 0)
                                            {
                                                <label><input type="radio" name="jenis_kelamin" value="0" class="radio" checked /> Laki-lak<br /></label>
                                                <label><input type="radio" name="jenis_kelamin" value="1" class="radio" /> Perempuan</label>
                                            }
                                            else
                                            {
                                                <label><input type="radio" name="jenis_kelamin" value="0" class="radio" /> Laki-lak<br /></label>
                                                <label><input type="radio" name="jenis_kelamin" value="1" class="radio" checked /> Perempuan</label>
                                            }

                                        }

                                    </div>
                                </div>
                                <div class="col">
                                    Email<span style="color:red">*</span>
                                    <input type="email" name="email" id="email" required value="@Model.email" />
                                </div>
                                <div class="col">
                                    No telepon<span style="color:red">*</span>
                                    <input type="number" name="no_telp" id="no_telp" required value="@Model.no_telp" />
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card-img">
                                <img id="gambar" src="~/Content/RoleRental/Image/Profil/@Model.profil" alt="@Model.nama_rental" class="card-img" />
                            </div>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col">
                            <div class="row">
                                <div class="col">
                                    Tempat lahir<span style="color:red">*</span>
                                    <input type="text" name="tempat_lahir" id="tempat_lahir" value="@Model.tempat_lahir" required />
                                </div>
                                <div class="col">
                                    Tanggal lahir<span style="color:red">*</span>
                                    <input type="date" name="tgl_lahir" id="tgl_lahir" value="@Model.tgl_lahir.ToString("yyyy-MM-dd")" required />
                                </div>
                            </div>
                            <br />
                            <div class="row">
                                <div class="col">
                                    Alamat<span style="color:red">*</span>
                                    <textarea rows="3" id="isi_alamat" class="form-control" required>@Model.alamat</textarea>
                                    <input type="hidden" name="alamat" id="alamat" />
                                </div>
                                <div class="col-4">
                                    Kodepos<span style="color:red">*</span>
                                    <select name="kodepos" id="kodepos" class="form-control" required>
                                        <option value="">- Pilih kodepos -</option>
                                        <option value="52363" selected>52363</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            NIK<span style="color:red">*</span>
                                            <input type="number" name="NIK" id="NIK" required value="@Model.NIK" />
                                        </div>
                                        <div class="col">
                                            Foto KTP<span style="color:red">*</span>
                                            <input type="file" name="berkas1" id="berkas1s" class="form-control-file" />
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row">
                                        <div class="col">

                                        </div>
                                        <div class="col">
                                            Foto SIM/NPWP<span style="color:red">*</span>
                                            <input type="file" name="berkas2" id="berkas2s" class="form-control-file" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr />
                    <div class="footer-widget">
                        <h4 style="color:black;width:200px">Informasi Toko</h4>
                    </div>
                    <div class="row">
                        <div class="col">
                            Nama toko<span style="color:red">*</span>
                            <input type="text" name="nama_toko" value="@Model.nama_toko" required />
                        </div>
                        <div class="col">
                            Alamat toko<span style="color:red">*</span>
                            <textarea rows="3" id="isi_alamat_toko" class="form-control" required>@Model.alamat_toko</textarea>
                            <input type="hidden" name="alamat_toko" id="alamat_toko" />
                        </div>
                        <div class="col">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            Nama bank<span style="color:red">*</span>
                                            <input type="text" name="nama_bank" value="@Model.nama_bank" />
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            No rek<span style="color:red">*</span>
                                            <input type="text" name="no_rek" value="@Model.no_rek" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>                    
                    <input type="submit" name="btnInsert" id="btnInsert" class="btn btn-primary" style="border-radius:0;" value="Perbarui" />
                </div>
            </div>
        </div>
    </div>
</form>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

    $(document).ready(function () {
        $("#profils").on("input", function () {
            
            var fd = new FormData();
            var gambar = document.getElementById("profils");
            if (gambar.value == null) {
                return;
            }
            fd.append(gambar.files[0].name, gambar.files[0]);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/Rental/uploadFile');
            xhr.send(fd);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    document.getElementById("gambar").src = "/Content/Temp/" + gambar.files[0].name;
                }
            }
        });
        $("#btnInsert").click(function () {
            document.getElementById("alamat").value = document.getElementById("isi_alamat").value;
            document.getElementById("alamat_toko").value = document.getElementById("isi_alamat_toko").value;

            
            if (document.getElementById("berkas1s").value != "") {
                uploadFileberkas1();
            }
           
            if (document.getElementById("berkas2s").value != "") {
                uploadFileberkas2();
            }
           
            if (document.getElementById("profils").value != "") {
                uploadFileprofil();
            }
           
        });
    });

    function uploadFileprofil() {
        var fd = new FormData();
        var gambar = document.getElementById("profils");
        if (gambar.value == null) {
            return;
        }
        fd.append(gambar.files[0].name, gambar.files[0]);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/Rental/uploadProfil');
        xhr.send(fd);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                
            }
        }
    }
    function uploadFileberkas1() {
        var fd = new FormData();
        var gambar = document.getElementById("berkas1s");
        if (gambar.value == null) {
            return;
        }
        fd.append(gambar.files[0].name, gambar.files[0]);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/Rental/uploadBerkas1');
        xhr.send(fd);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                
            }
        }
    }
    function uploadFileberkas2() {
        var fd = new FormData();
        var gambar = document.getElementById("berkas2s");
        if (gambar.value == null) {
            return;
        }
        fd.append(gambar.files[0].name, gambar.files[0]);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/Rental/uploadBerkas2');
        xhr.send(fd);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {                
            }
        }
    }
</script>


